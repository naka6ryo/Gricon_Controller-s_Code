# Gricon_Controller-s_Code

2024/12/27ã«æ¡ƒå±±å¤§å­¦ãƒ†ãƒƒã‚¯éƒ¨ä¸»å‚¬ã§é–‹å‚¬ã•ã‚ŒãŸãƒãƒƒã‚«ã‚½ãƒ³ã«å‡ºå±•ã—ãŸä½œå“ **Gricon** ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å´ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™ï¼ˆ2024/12/28 æ™‚ç‚¹ï¼‰ã€‚

ã“ã®Arduinoãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€IMUï¼ˆå§¿å‹¢ã‚»ãƒ³ã‚µï¼‰ã€æ›²ã’ã‚»ãƒ³ã‚µã€ãƒ¢ãƒ¼ã‚¿ãƒ¼ã‚’çµ±åˆã—ã€å§¿å‹¢æ¨å®šãƒ»å±ˆæ›²æ¤œå‡ºãƒ»æŒ¯å‹•å‡ºåŠ›ã‚’é€šã˜ã¦æ–°ã—ã„å…¥åŠ›ä½“é¨“ã‚’æä¾›ã—ã¾ã™ã€‚

å…¬å¼ã‚µã‚¤ãƒˆï¼šhttps://gricon.netlify.app/

## ğŸ¥ ãƒ‡ãƒ¢å‹•ç”»

[![Gricon ãƒ‡ãƒ¢å‹•ç”»](https://img.youtube.com/vi/qLPBSaw1i-E/0.jpg)](https://youtu.be/qLPBSaw1i-E?si=rnXXbKDZcDVdmmQi)

---

## ğŸ”— é–¢é€£ãƒªãƒ³ã‚¯

- ğŸ® **ã‚²ãƒ¼ãƒ å´ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆUnityï¼‰**  
  https://github.com/kdix-23-240/NewControllerProject-MomoyamaHack

- ğŸ“„ **ä½œå“ã«é–¢ã™ã‚‹æƒ…å ±ãƒ»ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®è§£èª¬ãƒ»é–‹ç™ºã®æµã‚Œã®èª¬æ˜ï¼ˆNotionï¼‰**  
  https://flossy-band-678.notion.site/Gricon-Arduino-Unity-16a9ff2ca96c8032b9a5cc3768512383?pvs=4

---

## ğŸ“Œ ç‰¹å¾´ / Features

- **9è»¸IMUã‚»ãƒ³ã‚µï¼ˆLSM9DS1ï¼‰** ã«ã‚ˆã‚‹ãƒ”ãƒƒãƒãƒ»ãƒ­ãƒ¼ãƒ«ãƒ»ãƒ¨ãƒ¼ã®æ¨å®š  
- **Madgwickãƒ•ã‚£ãƒ«ã‚¿** ã«ã‚ˆã‚‹é«˜ç²¾åº¦ãªå§¿å‹¢æ¨å®š  
- **æ›²ã’ã‚»ãƒ³ã‚µ** ã‚’ä½¿ã£ãŸã‚¢ãƒŠãƒ­ã‚°å…¥åŠ›å‡¦ç†ã¨å¹³æ»‘åŒ–  
- **åŠ é€Ÿåº¦ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ›ãƒ»æŒ¯å‹•æ¤œå‡º** ã«ã‚ˆã‚‹ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–å…¥åŠ›å¯¾å¿œ  
- **æŒ¯å‹•ãƒ¢ãƒ¼ã‚¿ãƒ¼å‡ºåŠ›** ã‚’é€šã˜ãŸãƒãƒ—ãƒ†ã‚£ã‚¯ã‚¹ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯  
- **ã‚·ãƒªã‚¢ãƒ«é€šä¿¡** ã«ã‚ˆã‚‹å¤–éƒ¨æ©Ÿå™¨ï¼ˆã‚²ãƒ¼ãƒ ï¼‰ã¨ã®åŒæ–¹å‘é€£æº  

---

## ğŸ”§ ä½¿ç”¨ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢

- Arduino Nano 33 BLE Sense ã¾ãŸã¯ LSM9DS1 æ­è¼‰ã®äº’æ›ãƒœãƒ¼ãƒ‰  
- æ›²ã’ã‚»ãƒ³ã‚µï¼ˆã‚¢ãƒŠãƒ­ã‚°å…¥åŠ›ï¼šA7ï¼‰  
- æŒ¯å‹•ãƒ¢ãƒ¼ã‚¿ãƒ¼ï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«å‡ºåŠ›ï¼šD9ï¼‰  
- å¤–éƒ¨é€šä¿¡ï¼šSerial1ï¼ˆ9600bpsï¼‰

---

## ğŸ“· å›è·¯å›³

ä»¥ä¸‹ã¯ã€æœ¬ãƒ‡ãƒã‚¤ã‚¹ã®å›è·¯å›³ã§ã™ï¼ˆArduino Nano 33 BLE + æ›²ã’ã‚»ãƒ³ã‚µ + ãƒ¢ãƒ¼ã‚¿ + Bluetoothæ§‹æˆï¼‰ï¼š

![Griconå›è·¯å›³](https://github.com/naka6ryo/Gricon_Controller-s_Code/blob/main/Gricon%20%E5%9B%9E%E8%B7%AF%E5%9B%B3.png)

---

## ğŸ“¤ ã‚»ãƒ³ã‚µå‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§**ãƒã‚¤ãƒŠãƒªå½¢å¼**ã®ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¾ã™ã€‚

[S][pitch (2 bytes)][roll (2 bytes)][yaw (2 bytes)][bend (1 byte)]


- `S`: ãƒ‡ãƒ¼ã‚¿é–‹å§‹ã‚’ç¤ºã™ãƒ˜ãƒƒãƒ€ï¼ˆ1ãƒã‚¤ãƒˆï¼‰  
- `pitch`, `roll`, `yaw`: å§¿å‹¢è§’ï¼ˆå„2ãƒã‚¤ãƒˆã€0.1Â°å˜ä½ï¼‰  
- `bend`: æ›²ã’ã‚»ãƒ³ã‚µå€¤ï¼ˆ0ã€œ20ã®ç¯„å›²ã«ã‚¯ãƒ©ãƒ³ãƒ—ï¼‰

---

## ğŸ” ãƒ¢ãƒ¼ã‚¿ãƒ¼åˆ¶å¾¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ˆSerial1 å—ä¿¡ï¼‰

ã‚·ãƒªã‚¢ãƒ«çµŒç”±ã§ä»¥ä¸‹ã®1æ–‡å­—ã‚³ãƒãƒ³ãƒ‰ã‚’é€ã‚‹ã“ã¨ã§ã€ãƒ¢ãƒ¼ã‚¿ãƒ¼ã®æŒ¯å‹•å‡ºåŠ›ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¤‰æ›´å¯èƒ½ï¼š

| ã‚³ãƒãƒ³ãƒ‰ | å‘¨æ³¢æ•° (Hzç›¸å½“) | ãƒ‡ãƒ¥ãƒ¼ãƒ†ã‚£æ¯” | å†…å®¹             |
|----------|------------------|--------------|------------------|
| `'1'`    | ç´„25Hz           | 40%          | å¼±ã„æŒ¯å‹•         |
| `'2'`    | ç´„50Hz           | 20%          | ä¸­ç¨‹åº¦ã®æŒ¯å‹•     |
| `'3'`    | ç´„100Hz          | 12.5%        | å¼·ã„æŒ¯å‹•         |
| `'4'`    | ç´„125Hz          | 90%          | é€£ç¶šæŒ¯å‹•         |
| ãã®ä»–    | -                | 0%           | ãƒ¢ãƒ¼ã‚¿ãƒ¼åœæ­¢     |

---

## ğŸ§­ ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ—ãƒ­ã‚°ãƒ©ãƒ é–‹å§‹æ™‚ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã€åœ°ç£æ°—ãƒ»ã‚¸ãƒ£ã‚¤ãƒ­ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚„æ›²ã’ã‚»ãƒ³ã‚µã®åˆæœŸå€¤ã‚’å–å¾—ãƒ»è£œæ­£ã—ã¾ã™ã€‚

---

## ğŸ”„ å‡¦ç†å‘¨æœŸã¨ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°

- å‡¦ç†å‘¨æœŸï¼š1msã”ã¨ã®ãƒ«ãƒ¼ãƒ—å®Ÿè¡Œï¼ˆç´„100Hzï¼‰  
- å„ç¨®ã‚»ãƒ³ã‚µå€¤ã«å¯¾ã—ã¦ãƒ•ã‚£ãƒ«ã‚¿ä¿‚æ•°ã‚’ç”¨ã„ãŸå¹³æ»‘åŒ–å‡¦ç†ã‚ã‚Š  
- å§¿å‹¢è§’ã®æ¨å®šã«ã¯ Madgwick ãƒ•ã‚£ãƒ«ã‚¿ã‚’ä½¿ç”¨

---

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚³ãƒ¼ãƒ‰ä¾‹

```cpp
void setup() {
  Serial.begin(9600);       // ãƒ‡ãƒãƒƒã‚°ç”¨
  Serial1.begin(9600);      // å¤–éƒ¨æ©Ÿå™¨ã¨ã®é€šä¿¡
  pinMode(motorPin, OUTPUT);
  initializeIMU();
  delay(100);
}
```

## ğŸ“š ä½¿ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå         | èª¬æ˜                        | ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•                                     |
|----------------------|-----------------------------|------------------------------------------------------|
| Arduino_LSM9DS1      | IMUï¼ˆåŠ é€Ÿåº¦ãƒ»ã‚¸ãƒ£ã‚¤ãƒ­ãƒ»åœ°ç£æ°—ï¼‰ã‚»ãƒ³ã‚µç”¨ | Arduino IDE â†’ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒãƒãƒ¼ã‚¸ãƒ£ã‹ã‚‰æ¤œç´¢ã—ã¦å°å…¥ |
| MadgwickAHRS         | å§¿å‹¢æ¨å®šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ         | Arduino IDE â†’ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒãƒãƒ¼ã‚¸ãƒ£ã‹ã‚‰æ¤œç´¢ã—ã¦å°å…¥ |

---

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ [MIT License](https://opensource.org/licenses/MIT) ã®ã‚‚ã¨ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

# Gricon Controller Code

This repository contains the **controller-side program** for **Gricon**, a project exhibited at a hackathon hosted by the **Momoyama University Tech Club** on **December 27, 2024** (status as of **December 28, 2024**).

This Arduino program integrates an **IMU (inertial measurement unit)**, a **flex sensor**, and a **vibration motor** to provide a new input experience through **orientation estimation**, **bend detection**, and **haptic feedback**.

Official site: https://gricon.netlify.app/

---

## ğŸ¥ Demo Video

[![Gricon Demo Video](https://img.youtube.com/vi/qLPBSaw1i-E/0.jpg)](https://youtu.be/qLPBSaw1i-E?si=rnXXbKDZcDVdmmQi)

---

## ğŸ”— Related Links

- ğŸ® **Game-side program (Unity)**  
  https://github.com/kdix-23-240/NewControllerProject-MomoyamaHack

- ğŸ“„ **Project details / source code explanation / development process (Notion)**  
  https://flossy-band-678.notion.site/Gricon-Arduino-Unity-16a9ff2ca96c8032b9a5cc3768512383?pvs=4

---

## ğŸ“Œ Features

- **9-axis IMU (LSM9DS1)** for estimating **pitch / roll / yaw**
- **High-accuracy orientation estimation** using the **Madgwick filter**
- **Analog flex sensor processing** with smoothing
- **Global-frame acceleration conversion & vibration detection** for reactive input
- **Haptic feedback** via vibration motor output
- **Bidirectional communication** with external devices (e.g., a game) via **serial**

---

## ğŸ”§ Hardware Used

- Arduino Nano 33 BLE Sense or a compatible board with LSM9DS1
- Flex sensor (analog input: A7)
- Vibration motor (digital output: D9)
- External communication: Serial1 (9600 bps)

---

## ğŸ“· Circuit Diagram

Below is the circuit diagram for this device (Arduino Nano 33 BLE + flex sensor + motor + Bluetooth configuration):

![Gricon Circuit Diagram](https://github.com/naka6ryo/Gricon_Controller-s_Code/blob/main/Gricon%20%E5%9B%9E%E8%B7%AF%E5%9B%B3.png)

---

## ğŸ“¤ Sensor Output Format

The controller sends data in the following **binary** format:

`[S][pitch (2 bytes)][roll (2 bytes)][yaw (2 bytes)][bend (1 byte)]`

- `S`: 1-byte header indicating the start of a packet  
- `pitch`, `roll`, `yaw`: Euler angles (2 bytes each, in 0.1Â° units)  
- `bend`: flex sensor value (clamped to 0â€“20)

---

## ğŸ” Motor Control Protocol (Serial1 Receive)

You can change the vibration output pattern by sending a **single-character command** over serial:

| Command | Frequency (approx.) | Duty Cycle | Description          |
|:------:|:---------------------|:----------:|----------------------|
| `'1'`  | ~25 Hz               | 40%        | Weak vibration       |
| `'2'`  | ~50 Hz               | 20%        | Medium vibration     |
| `'3'`  | ~100 Hz              | 12.5%      | Strong vibration     |
| `'4'`  | ~125 Hz              | 90%        | Continuous vibration |
| Other  | â€“                    | 0%         | Motor off            |

---

## ğŸ§­ Calibration

Calibration runs automatically at startup to obtain and compensate:

- Magnetometer / gyroscope offsets  
- Initial baseline for the flex sensor  

---

## ğŸ”„ Loop Rate & Smoothing

- Loop cycle: executed every 1 ms (â‰ˆ 100 Hz)  
- Sensor values are smoothed using filter coefficients  
- Orientation estimation uses the Madgwick filter

---

## ğŸš€ Setup Code Example

```cpp
void setup() {
  Serial.begin(9600);       // For debugging
  Serial1.begin(9600);      // Communication with external device
  pinMode(motorPin, OUTPUT);
  initializeIMU();
  delay(100);
}
```

ğŸ“š Libraries Used
Library	Description	Installation Method
Arduino_LSM9DS1	IMU (accel / gyro / magnetometer) library	Arduino IDE â†’ Library Manager â†’ search & install
MadgwickAHRS	AHRS orientation estimation algorithm	Arduino IDE â†’ Library Manager â†’ search & install
ğŸ“ License

This project is released under the MIT License:
https://opensource.org/licenses/MIT


